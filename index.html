<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vozes ‚Äî Comunidade (Admin)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{ --bg:#0f172a; --card:#0b1220; --text:#e6eef8; --accent:#6ee7b7; }
  [data-theme="ocean"]{ --bg:#0f172a; --card:#071029; --text:#e6f7ff; --accent:#60a5fa }
  [data-theme="sunset"]{ --bg:#fff7f0; --card:#fff1e6; --text:#2b2b2b; --accent:#f97316 }
  [data-theme="mint"]{ --bg:#f6fffb; --card:#ecfff5; --text:#03251a; --accent:#34d399 }

  body{ background:var(--bg); color:var(--text); transition: background .25s, color .25s; }
  .card{ background:var(--card); color:var(--text); transition: background .25s; box-shadow:0 6px 18px rgba(2,6,23,0.4); }
  .btn-accent{ background:var(--accent); color:inherit; transition: transform .14s; }
  .btn-accent:hover{ transform:scale(1.03); }
  .avatar-sm{ width:36px;height:36px;border-radius:999px;object-fit:cover; }
  .avatar-lg{ width:110px;height:140px;border-radius:8px;object-fit:cover; }
  .img-thumb{ max-height:110px; object-fit:cover; border-radius:6px }
  .toast{ position:fixed; top:1rem; right:1rem; background:var(--card); padding:.65rem .9rem; border-radius:.45rem; box-shadow:0 6px 20px rgba(0,0,0,.45); z-index:60; }
  .modal-backdrop{ background: rgba(0,0,0,0.55); backdrop-filter: blur(2px); }
  .role-badge{ font-size:11px; padding:.15rem .4rem; border-radius:999px; background:rgba(255,255,255,.06); margin-left:.5rem; }
  .danger{ background: #7f1d1d; color: #fff; padding: .25rem .5rem; border-radius:6px; }
  .muted{ opacity:.75; }
  input:focus, textarea:focus{ outline:none; box-shadow:0 0 0 2px var(--accent); }
</style>
</head>
<body data-theme="ocean" class="min-h-screen antialiased">
<div class="max-w-6xl mx-auto p-4">

<header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
  <div>
    <h1 class="text-3xl font-extrabold">Vozes</h1>
    <p class="text-sm opacity-80">Comunidade para criar, buscar e compartilhar personagens ‚Äî vers√£o com roles/admin.</p>
  </div>
  <div class="flex items-center gap-3 flex-wrap">
    <input id="search" type="search" aria-label="Pesquisar personagem" placeholder="Pesquisar..." class="px-3 py-2 rounded-md bg-white/5 placeholder:opacity-60" />
    <div class="relative">
      <button id="themeBtn" aria-label="Trocar paleta" class="px-3 py-2 rounded-md card">üé® Paleta</button>
      <div id="themeMenu" class="hidden absolute right-0 mt-2 w-44 card p-2 rounded-md shadow-lg">
        <button class="w-full text-left px-2 py-2 rounded hover:bg-white/5" data-theme="ocean">Ocean (padr√£o)</button>
        <button class="w-full text-left px-2 py-2 rounded hover:bg-white/5" data-theme="sunset">Sunset</button>
        <button class="w-full text-left px-2 py-2 rounded hover:bg-white/5" data-theme="mint">Mint</button>
      </div>
    </div>

    <div id="authArea" class="flex items-center gap-2">
      <button id="btnLogin" class="px-3 py-2 rounded-md card">Entrar</button>
      <button id="btnRegister" class="px-3 py-2 rounded-md btn-accent">Criar Conta</button>
    </div>

    <div id="userArea" class="hidden items-center gap-2">
      <img id="headerAvatar" class="avatar-sm" alt="avatar"/>
      <span id="headerName" class="text-sm opacity-90"></span>
      <span id="headerRole" class="role-badge muted"></span>
      <button id="btnProfile" class="px-3 py-1 rounded-md card">Meu Perfil</button>
      <button id="btnNewPost" class="px-3 py-1 rounded-md btn-accent">+ Novo Post</button>
      <button id="btnLogout" class="px-3 py-1 rounded-md card">Sair</button>
    </div>
  </div>
</header>

<main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <section class="col-span-1 lg:col-span-2 space-y-4">
    <div id="posts" class="space-y-4"></div>
  </section>
  <aside class="card p-4 rounded-md hidden lg:block sticky top-6">
    <h2 class="text-xl font-semibold mb-2">Como usar</h2>
    <ol class="list-decimal ml-5 space-y-1 text-sm opacity-90">
      <li>Crie/entre em sua conta para postar e comentar. O primeiro usu√°rio cadastrado torna-se <strong>admin</strong>.</li>
      <li>Admins podem deletar posts/coment√°rios e promover outros usu√°rios.</li>
      <li>Clique em avatar/nome para abrir perfil p√∫blico.</li>
      <li>Pronto para migrar a camada <code>api</code> para um backend real.</li>
    </ol>
  </aside>
</main>
<footer class="mt-8 text-xs opacity-80 text-center">Vers√£o prot√≥tipo ‚Äî persist√™ncia local (localStorage).</footer>
</div>

<div id="modalBackdrop" class="fixed inset-0 hidden z-40 modal-backdrop"></div>

<!-- Login Modal -->
<div id="loginModal" class="fixed inset-0 hidden z-50 items-center justify-center p-4">
  <div class="w-full max-w-md card rounded-lg p-5">
    <h3 class="text-xl font-semibold mb-3">Entrar</h3>
    <form id="loginForm" class="space-y-3" aria-label="Formul√°rio de login">
      <div><label class="text-sm">Nickname</label><input id="loginNick" required class="w-full px-3 py-2 rounded-md bg-white/5" /></div>
      <div><label class="text-sm">Senha</label><input id="loginPass" type="password" required class="w-full px-3 py-2 rounded-md bg-white/5" /></div>
      <div class="flex justify-end gap-2">
        <button type="button" id="loginCancel" class="px-3 py-2 rounded-md card">Cancelar</button>
        <button type="submit" class="px-4 py-2 rounded-md btn-accent">Entrar</button>
      </div>
    </form>
  </div>
</div>

<!-- Register Modal -->
<div id="registerModal" class="fixed inset-0 hidden z-50 items-center justify-center p-4">
  <div class="w-full max-w-md card rounded-lg p-5">
    <h3 class="text-xl font-semibold mb-3">Criar Conta</h3>
    <form id="registerForm" class="space-y-3" aria-label="Formul√°rio de registro">
      <div><label class="text-sm">Nickname</label><input id="regNick" required class="w-full px-3 py-2 rounded-md bg-white/5" /></div>
      <div><label class="text-sm">Senha</label><input id="regPass" type="password" required class="w-full px-3 py-2 rounded-md bg-white/5" /></div>
      <div><label class="text-sm">Foto (opcional)</label><input id="regAvatar" type="file" accept="image/*" class="w-full text-sm" /></div>
      <div class="flex justify-end gap-2">
        <button type="button" id="regCancel" class="px-3 py-2 rounded-md card">Cancelar</button>
        <button type="submit" class="px-4 py-2 rounded-md btn-accent">Criar</button>
      </div>
    </form>
  </div>
</div>

<!-- New Post Modal -->
<div id="postModal" class="fixed inset-0 hidden z-50 items-center justify-center p-4 overflow-auto">
  <div class="w-full max-w-lg card rounded-lg p-5">
    <h3 class="text-xl font-semibold mb-3">Novo Post</h3>
    <form id="postForm" class="space-y-3">
      <div><label class="text-sm">T√≠tulo</label><input id="postTitle" required class="w-full px-3 py-2 rounded-md bg-white/5" /></div>
      <div><label class="text-sm">Descri√ß√£o</label><textarea id="postDesc" required class="w-full px-3 py-2 rounded-md bg-white/5"></textarea></div>
      <div><label class="text-sm">Imagem (opcional)</label><input id="postImg" type="file" accept="image/*" class="w-full text-sm" /></div>
      <div class="flex justify-end gap-2">
        <button type="button" id="postCancel" class="px-3 py-2 rounded-md card">Cancelar</button>
        <button type="submit" class="px-4 py-2 rounded-md btn-accent">Postar</button>
      </div>
    </form>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
function toast(msg){ const d=document.createElement('div'); d.className='toast'; d.textContent=msg; document.body.appendChild(d); setTimeout(()=>d.remove(),2600); }
function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function showModal(el){ $('modalBackdrop').classList.remove('hidden'); el.classList.remove('hidden'); }
function hideModal(el){ el.classList.add('hidden'); const modals=Array.from(document.querySelectorAll('.fixed.z-50')).filter(m=>!m.classList.contains('hidden')); if(modals.length===0) $('modalBackdrop').classList.add('hidden'); }

async function hash(str){ const buf=await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str)); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
async function fileToDataURL(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }

let db={users:[], posts:[]}, session=null;

function saveDB(){ localStorage.setItem('vozes_db', JSON.stringify(db)); }
function loadDB(){ const d=localStorage.getItem('vozes_db'); db=d?JSON.parse(d):{users:[],posts:[]}; }

function initUI(){
  if(session){
    $('authArea').classList.add('hidden');
    $('userArea').classList.remove('hidden');
    const u=db.users.find(x=>x.id===session);
    $('headerAvatar').src=u.avatar||'https://i.pravatar.cc/36';
    $('headerName').textContent=u.nickname;
    $('headerRole').textContent=u.role;
  }else{
    $('authArea').classList.remove('hidden');
    $('userArea').classList.add('hidden');
  }
}

function renderPosts(filter=''){
  const container=$('posts');
  container.innerHTML='';
  db.posts.filter(p=>p.title.toLowerCase().includes(filter.toLowerCase())).sort((a,b)=>b.date-a.date).forEach(p=>{
    const user=db.users.find(u=>u.id===p.author);
    const div=document.createElement('div');
    div.className='card p-4 rounded-md';
    div.innerHTML=`<div class="flex justify-between items-center mb-2">
      <div class="flex items-center gap-2">
        <img src="${user.avatar||'https://i.pravatar.cc/36'}" class="avatar-sm"/>
        <span>${escapeHtml(user.nickname)}</span>
        <span class="role-badge muted">${user.role}</span>
      </div>
      ${session===p.author||db.users.find(u=>u.id===session)?.role==='admin'?`<button data-id="${p.id}" class="deletePost px-2 py-1 danger text-xs">Deletar</button>`:''}
    </div>
    <h4 class="font-semibold">${escapeHtml(p.title)}</h4>
    <p class="mt-1 mb-2">${escapeHtml(p.desc)}</p>
    ${p.img?`<img src="${p.img}" class="img-thumb">`:''}`;
    container.appendChild(div);
  });
  document.querySelectorAll('.deletePost').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const id=e.currentTarget.dataset.id;
      db.posts=db.posts.filter(x=>x.id!==id); saveDB(); renderPosts($('search').value); toast('Post deletado');
    });
  });
}

loadDB(); initUI(); renderPosts();

$('btnLogin').onclick=()=>showModal($('loginModal'));
$('loginCancel').onclick=()=>hideModal($('loginModal'));
$('btnRegister').onclick=()=>showModal($('registerModal'));
$('regCancel').onclick=()=>hideModal($('registerModal'));
$('btnNewPost').onclick=()=>showModal($('postModal'));
$('postCancel').onclick=()=>hideModal($('postModal'));

$('themeBtn').onclick=()=> $('themeMenu').classList.toggle('hidden');
document.querySelectorAll('#themeMenu button').forEach(b=>b.onclick=e=>{
  document.body.setAttribute('data-theme',e.currentTarget.dataset.theme);
  localStorage.setItem('vozes_theme', e.currentTarget.dataset.theme);
  $('themeMenu').classList.add('hidden'); toast('Tema alterado');
});
document.body.setAttribute('data-theme', localStorage.getItem('vozes_theme')||'ocean');

$('loginForm').onsubmit=async e=>{
  e.preventDefault();
  const nick=$('loginNick').value, pass=$('loginPass').value;
  const h=await hash(pass);
  const u=db.users.find(x=>x.nickname===nick&&x.pass===h);
  if(u){ session=u.id; initUI(); hideModal($('loginModal')); toast('Login realizado'); }
  else toast('Credenciais inv√°lidas');
};

$('registerForm').onsubmit=async e=>{
  e.preventDefault();
  const nick=$('regNick').value, pass=$('regPass').value, avatarFile=$('regAvatar').files[0];
  if(db.users.find(x=>x.nickname===nick)){ toast('Nickname j√° existe'); return; }
  const h=await hash(pass);
  const avatar=avatarFile?await fileToDataURL(avatarFile):null;
  const u={id:Date.now().toString(), nickname:nick, pass:h, avatar:avatar, role:db.users.length===0?'admin':'user'};
  db.users.push(u); saveDB(); toast('Conta criada'); hideModal($('registerModal'));
};

$('postForm').onsubmit=async e=>{
  e.preventDefault();
  const title=$('postTitle').value, desc=$('postDesc').value, imgFile=$('postImg').files[0];
  const img=imgFile?await fileToDataURL(imgFile):null;
  const post={id:Date.now().toString(), title, desc, img, author:session, date:Date.now()};
  db.posts.push(post); saveDB(); hideModal($('postModal')); renderPosts($('search').value); toast('Post criado');
};

$('btnLogout').onclick=()=>{ session=null; initUI(); renderPosts($('search').value); toast('Deslogado'); };
$('search').oninput=e=>renderPosts(e.currentTarget.value);

</script>
</body>
</html>
l>
